# Mintlify Documentation Setup

This project uses [Mintlify](https://mintlify.com) for API documentation with OpenAPI integration.

## Prerequisites

```bash
npm install -g mintlify
```

## Local Development

1. **Start the FastAPI server** (required for OpenAPI spec):

```bash
uv run python -m glyx.mcp.server
# Server runs on http://localhost:8000
```

2. **Fetch the latest OpenAPI spec**:

```bash
curl http://localhost:8000/openapi.json -o docs/openapi.json
```

3. **Start Mintlify dev server**:

```bash
mintlify dev
```

The documentation will be available at `http://localhost:3000`.

## File Structure

```
glyx-mcp/
├── mint.json                      # Mintlify configuration
├── introduction.mdx               # Homepage
├── quickstart.mdx                 # Getting started guide
├── authentication.mdx             # Auth guide
├── docs/
│   ├── openapi.json              # OpenAPI specification (auto-generated)
│   ├── api-reference/
│   │   └── introduction.mdx      # API docs intro
│   └── guides/
│       ├── agent-orchestration.mdx
│       ├── memory-management.mdx
│       ├── feature-pipelines.mdx
│       └── webhooks.mdx
```

## Updating Documentation

### 1. Update OpenAPI Spec

The OpenAPI spec is automatically generated by FastAPI. After making API changes:

```bash
# Ensure server is running
curl http://localhost:8000/openapi.json -o docs/openapi.json
```

### 2. Update Content Pages

Edit the `.mdx` files directly:

- **Introduction**: `introduction.mdx`
- **Quickstart**: `quickstart.mdx`
- **Guides**: `docs/guides/*.mdx`
- **API Reference**: Auto-generated from OpenAPI

### 3. Add New Pages

1. Create new `.mdx` file
2. Add to `mint.json` navigation:

```json
{
  "group": "New Group",
  "pages": [
    "path/to/new-page"
  ]
}
```

## OpenAPI Integration

### Automatic Endpoint Documentation

Mintlify automatically generates endpoint documentation from `docs/openapi.json`. Endpoints appear in the sidebar based on their tags.

### Customizing Endpoint Pages

Use the `x-mint` extension in FastAPI:

```python
@api_router.get(
    "/custom-endpoint",
    openapi_extra={
        "x-mint": {
            "title": "Custom Title",
            "description": "Custom description that appears in docs"
        }
    }
)
async def custom_endpoint():
    pass
```

## Authentication in Playground

The API playground supports Bearer token authentication. Configure in `mint.json`:

```json
{
  "api": {
    "auth": {
      "method": "bearer"
    }
  }
}
```

Users can test authenticated endpoints directly in the docs.

## Deployment

### Option 1: Mintlify Hosting

1. **Connect GitHub repository**:
   - Go to [Mintlify Dashboard](https://dashboard.mintlify.com)
   - Connect your GitHub repository
   - Mintlify will auto-deploy on push

2. **Configure custom domain** (optional):
   - Add CNAME record: `docs.yourdomain.com → mintlify.app`
   - Configure in Mintlify dashboard

### Option 2: Self-Hosted

Build static site:

```bash
mintlify build
```

Deploy to:
- Vercel: `vercel deploy`
- Netlify: `netlify deploy`
- GitHub Pages: Push to `gh-pages` branch

## Best Practices

### 1. Keep OpenAPI Spec Updated

Add a pre-commit hook to update the spec:

```bash
#!/bin/bash
# .git/hooks/pre-commit

# Check if server is running
if ! curl -s http://localhost:8000/healthz > /dev/null; then
    echo "Warning: FastAPI server not running. OpenAPI spec may be outdated."
    exit 0
fi

# Update OpenAPI spec
curl -s http://localhost:8000/openapi.json -o docs/openapi.json
git add docs/openapi.json
```

### 2. Add Examples to Endpoints

Include request/response examples in FastAPI:

```python
@api_router.post(
    "/tasks",
    response_model=TaskResponse,
    responses={
        201: {
            "description": "Task created successfully",
            "content": {
                "application/json": {
                    "example": {
                        "id": "task-123",
                        "title": "Implement authentication",
                        "status": "in_progress"
                    }
                }
            }
        }
    }
)
async def create_task(body: TaskCreate):
    pass
```

### 3. Use Tags for Organization

Group related endpoints with tags:

```python
@api_router.get("/tasks", tags=["Tasks"])
@api_router.post("/tasks", tags=["Tasks"])
@api_router.get("/organizations", tags=["Organizations"])
```

Tags automatically create sections in Mintlify.

### 4. Document Response Models

Use Pydantic models with descriptions:

```python
class TaskResponse(BaseModel):
    """Task object returned by the API."""

    id: str = Field(description="Unique task identifier")
    title: str = Field(description="Task title (max 80 chars)")
    status: str = Field(description="Current status: pending, in_progress, done")
```

## Troubleshooting

### OpenAPI spec not loading

**Issue**: Mintlify shows "Failed to load OpenAPI spec"

**Solution**:
1. Verify `docs/openapi.json` exists and is valid JSON
2. Check file path in `mint.json` is correct: `"openapi": "docs/openapi.json"`
3. Ensure server URLs in spec match your environment

### Endpoints not appearing

**Issue**: API endpoints don't show in sidebar

**Solution**:
1. Check endpoint tags match navigation groups in `mint.json`
2. Verify OpenAPI spec includes the endpoint
3. Restart Mintlify dev server: `mintlify dev`

### Authentication not working in playground

**Issue**: Bearer token auth doesn't work in API playground

**Solution**:
1. Verify `api.auth.method` is set to `"bearer"` in `mint.json`
2. Check OpenAPI spec has `securitySchemes` defined
3. Ensure endpoints have `security` requirement

### Images not loading

**Issue**: Images in docs not displaying

**Solution**:
1. Place images in `/public` directory
2. Reference with absolute paths: `![Alt](/images/logo.png)`
3. Supported formats: PNG, JPG, SVG

## Resources

- [Mintlify Documentation](https://mintlify.com/docs)
- [OpenAPI Setup Guide](https://mintlify.com/docs/api-playground/openapi-setup)
- [FastAPI OpenAPI Docs](https://fastapi.tiangolo.com/advanced/extending-openapi/)
- [MDX Documentation](https://mdxjs.com/)

## CI/CD Integration

### GitHub Actions

Auto-update OpenAPI spec on push:

```yaml
# .github/workflows/update-docs.yml
name: Update Docs

on:
  push:
    branches: [main]
    paths:
      - 'src/glyx/mcp/server.py'

jobs:
  update-openapi:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - name: Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.12'

      - name: Install dependencies
        run: |
          pip install uv
          uv pip install -e ".[dev]"

      - name: Start server
        run: |
          uv run python -m glyx.mcp.server &
          sleep 5

      - name: Update OpenAPI spec
        run: |
          curl http://localhost:8000/openapi.json -o docs/openapi.json

      - name: Commit changes
        run: |
          git config user.name "GitHub Actions"
          git config user.email "actions@github.com"
          git add docs/openapi.json
          git commit -m "Update OpenAPI spec" || exit 0
          git push
```

## Support

For issues with:
- **Mintlify**: https://mintlify.com/docs/support
- **Glyx MCP**: https://github.com/htelsiz/glyx-mcp/issues
